import{r as P,R as Z,j}from"./index-KCc579kG.js";var h={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let Q=0;function tt(e,s){const a=`atom${++Q}`,g={toString:()=>a};return typeof e=="function"?g.read=e:(g.init=e,g.read=function(w){return w(this)},g.write=function(w,_,A){return _(this,typeof A=="function"?A(w(this)):A)}),s&&(g.write=s),g}const U=e=>"init"in e,B=e=>!!e.write,N=new WeakMap,et=(e,s)=>{N.set(e,s),e.catch(()=>{}).finally(()=>N.delete(e))},W=(e,s)=>{const a=N.get(e);a&&(N.delete(e),a(s))},q=(e,s)=>{e.status="fulfilled",e.value=s},$=(e,s)=>{e.status="rejected",e.reason=s},nt=e=>typeof(e==null?void 0:e.then)=="function",m=(e,s)=>!!e&&"v"in e&&"v"in s&&Object.is(e.v,s.v),G=(e,s)=>!!e&&"e"in e&&"e"in s&&Object.is(e.e,s.e),M=e=>!!e&&"v"in e&&e.v instanceof Promise,ot=(e,s)=>"v"in e&&"v"in s&&e.v.orig&&e.v.orig===s.v.orig,T=e=>{if("e"in e)throw e.e;return e.v},rt=()=>{const e=new WeakMap,s=new WeakMap,a=new Map;let g,w;(h?"production":void 0)!=="production"&&(g=new Set,w=new Set);const _=t=>e.get(t),A=(t,o)=>{(h?"production":void 0)!=="production"&&Object.freeze(o);const i=e.get(t);if(e.set(t,o),a.has(t)||a.set(t,i),M(i)){const n="v"in o?o.v instanceof Promise?o.v:Promise.resolve(o.v):Promise.reject(o.e);i.v!==n&&W(i.v,n)}},S=(t,o,i)=>{const n=new Map;let c=!1;i.forEach((d,r)=>{!d&&r===t&&(d=o),d?(n.set(r,d),o.d.get(r)!==d&&(c=!0)):(h?"production":void 0)!=="production"&&console.warn("[Bug] atom state not found")}),(c||o.d.size!==n.size)&&(o.d=n)},y=(t,o,i)=>{const n=_(t),c={d:(n==null?void 0:n.d)||new Map,v:o};if(i&&S(t,c,i),m(n,c)&&n.d===c.d)return n;if(M(n)&&M(c)&&ot(n,c)){if(n.d===c.d)return n;c.v=n.v}return A(t,c),c},E=(t,o,i,n)=>{if(nt(o)){let c;const d=()=>{const u=_(t);if(!M(u)||u.v!==r)return;const v=y(t,r,i);s.has(t)&&u.d!==v.d&&L(t,v,u.d)},r=new Promise((u,v)=>{let l=!1;o.then(f=>{l||(l=!0,q(r,f),u(f),d())},f=>{l||(l=!0,$(r,f),v(f),d())}),c=f=>{l||(l=!0,f.then(p=>q(r,p),p=>$(r,p)),u(f))}});return r.orig=o,r.status="pending",et(r,u=>{u&&c(u),n==null||n()}),y(t,r,i)}return y(t,o,i)},R=(t,o,i)=>{const n=_(t),c={d:(n==null?void 0:n.d)||new Map,e:o};return i&&S(t,c,i),G(n,c)&&n.d===c.d?n:(A(t,c),c)},b=(t,o)=>{const i=_(t);if(!o&&i&&(s.has(t)||Array.from(i.d).every(([l,f])=>{if(l===t)return!0;const p=b(l);return p===f||m(p,f)})))return i;const n=new Map;let c=!0;const d=l=>{if(l===t){const p=_(l);if(p)return n.set(l,p),T(p);if(U(l))return n.set(l,void 0),l.init;throw new Error("no atom init")}const f=b(l);return n.set(l,f),T(f)};let r,u;const v={get signal(){return r||(r=new AbortController),r.signal},get setSelf(){return(h?"production":void 0)!=="production"&&!B(t)&&console.warn("setSelf function cannot be used with read-only atom"),!u&&B(t)&&(u=(...l)=>{if((h?"production":void 0)!=="production"&&c&&console.warn("setSelf function cannot be called in sync"),!c)return C(t,...l)}),u}};try{const l=t.read(d,v);return E(t,l,n,()=>r==null?void 0:r.abort())}catch(l){return R(t,l,n)}finally{c=!1}},x=t=>T(b(t)),K=t=>{let o=s.get(t);return o||(o=k(t)),o},V=(t,o)=>!o.l.size&&(!o.t.size||o.t.size===1&&o.t.has(t)),X=t=>{const o=s.get(t);o&&V(t,o)&&I(t)},z=t=>{const o=new Map,i=new WeakMap,n=r=>{var u;const v=new Set((u=s.get(r))==null?void 0:u.t);return a.forEach((l,f)=>{var p;(p=_(f))!=null&&p.d.has(r)&&v.add(f)}),v},c=r=>{n(r).forEach(u=>{u!==r&&(o.set(u,(o.get(u)||new Set).add(r)),i.set(u,(i.get(u)||0)+1),c(u))})};c(t);const d=r=>{n(r).forEach(u=>{var v;if(u!==r){let l=i.get(u);if(l&&i.set(u,--l),!l){let f=!!((v=o.get(u))!=null&&v.size);if(f){const p=_(u),Y=b(u,!0);f=!m(p,Y)}f||o.forEach(p=>p.delete(u))}d(u)}})};d(t)},F=(t,...o)=>{let i=!0;const n=r=>T(b(r)),c=(r,...u)=>{let v;if(r===t){if(!U(r))throw new Error("atom not writable");const l=_(r),f=E(r,u[0]);m(l,f)||z(r)}else v=F(r,...u);if(!i){const l=O();(h?"production":void 0)!=="production"&&g.forEach(f=>f({type:"async-write",flushed:l}))}return v},d=t.write(n,c,...o);return i=!1,d},C=(t,...o)=>{const i=F(t,...o),n=O();return(h?"production":void 0)!=="production"&&g.forEach(c=>c({type:"write",flushed:n})),i},k=(t,o,i)=>{var n;const c=i||[];(n=_(t))==null||n.d.forEach((r,u)=>{const v=s.get(u);v?v.t.add(t):u!==t&&k(u,t,c)}),b(t);const d={t:new Set(o&&[o]),l:new Set};if(s.set(t,d),(h?"production":void 0)!=="production"&&w.add(t),B(t)&&t.onMount){const{onMount:r}=t;c.push(()=>{const u=r((...v)=>C(t,...v));u&&(d.u=u)})}return i||c.forEach(r=>r()),d},I=t=>{var o;const i=(o=s.get(t))==null?void 0:o.u;i&&i(),s.delete(t),(h?"production":void 0)!=="production"&&w.delete(t);const n=_(t);n?(M(n)&&W(n.v),n.d.forEach((c,d)=>{if(d!==t){const r=s.get(d);r&&(r.t.delete(t),V(d,r)&&I(d))}})):(h?"production":void 0)!=="production"&&console.warn("[Bug] could not find atom state to unmount",t)},L=(t,o,i)=>{const n=new Set(o.d.keys()),c=new Set;i==null||i.forEach((d,r)=>{if(n.has(r)){n.delete(r);return}c.add(r);const u=s.get(r);u&&u.t.delete(t)}),n.forEach(d=>{const r=s.get(d);r?r.t.add(t):s.has(t)&&k(d,t)}),c.forEach(d=>{const r=s.get(d);r&&V(d,r)&&I(d)})},O=()=>{let t;for((h?"production":void 0)!=="production"&&(t=new Set);a.size;){const o=Array.from(a);a.clear(),o.forEach(([i,n])=>{const c=_(i);if(c){const d=s.get(i);d&&c.d!==(n==null?void 0:n.d)&&L(i,c,n==null?void 0:n.d),d&&!(!M(n)&&(m(n,c)||G(n,c)))&&(d.l.forEach(r=>r()),(h?"production":void 0)!=="production"&&t.add(i))}else(h?"production":void 0)!=="production"&&console.warn("[Bug] no atom state to flush")})}if((h?"production":void 0)!=="production")return t},J=(t,o)=>{const i=K(t),n=O(),c=i.l;return c.add(o),(h?"production":void 0)!=="production"&&g.forEach(d=>d({type:"sub",flushed:n})),()=>{c.delete(o),X(t),(h?"production":void 0)!=="production"&&g.forEach(d=>d({type:"unsub"}))}};return(h?"production":void 0)!=="production"?{get:x,set:C,sub:J,dev_subscribe_store:(t,o)=>{if(o!==2)throw new Error("The current StoreListener revision is 2.");return g.add(t),()=>{g.delete(t)}},dev_get_mounted_atoms:()=>w.values(),dev_get_atom_state:t=>e.get(t),dev_get_mounted:t=>s.get(t),dev_restore_atoms:t=>{for(const[i,n]of t)U(i)&&(E(i,n),z(i));const o=O();g.forEach(i=>i({type:"restore",flushed:o}))}}:{get:x,set:C,sub:J}};let D;(h?"production":void 0)!=="production"&&(typeof globalThis.__NUMBER_OF_JOTAI_INSTANCES__=="number"?++globalThis.__NUMBER_OF_JOTAI_INSTANCES__:globalThis.__NUMBER_OF_JOTAI_INSTANCES__=1);const st=()=>(D||((h?"production":void 0)!=="production"&&globalThis.__NUMBER_OF_JOTAI_INSTANCES__!==1&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"),D=rt()),D);var it={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const ct=P.createContext(void 0),H=e=>{const s=P.useContext(ct);return(e==null?void 0:e.store)||s||st()},ut=e=>typeof(e==null?void 0:e.then)=="function",dt=Z.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(e.status="pending",e.then(s=>{e.status="fulfilled",e.value=s},s=>{e.status="rejected",e.reason=s}),e)});function lt(e,s){const a=H(s),[[g,w,_],A]=P.useReducer(E=>{const R=a.get(e);return Object.is(E[0],R)&&E[1]===a&&E[2]===e?E:[R,a,e]},void 0,()=>[a.get(e),a,e]);let S=g;(w!==a||_!==e)&&(A(),S=a.get(e));const y=s==null?void 0:s.delay;return P.useEffect(()=>{const E=a.sub(e,()=>{if(typeof y=="number"){setTimeout(A,y);return}A()});return A(),E},[a,e,y]),P.useDebugValue(S),ut(S)?dt(S):S}function ft(e,s){const a=H(s);return P.useCallback((...w)=>{if((it?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return a.set(e,...w)},[a,e])}function at(e,s){return[lt(e,s),ft(e,s)]}const vt=tt(0),gt=()=>{const[e,s]=at(vt);return j.jsxs(j.Fragment,{children:[j.jsx("p",{children:e}),j.jsx("button",{onClick:()=>{s(e+1)},children:"Add count"})]})};export{gt as default};
